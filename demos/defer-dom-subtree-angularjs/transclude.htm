<!doctype html>
<html ng-app="Demo" ng-controller="AppController">
<head>
	<meta charset="utf-8" />

	<title>
		
	</title>

	<style type="text/css">

		ul {
			list-style-type: none ;
			padding: 0px 0px 0px 0px ;
		}

		li {
			border: 1px solid #CCCCCC ;
			margin: 0px 0px 2px 0px ;
			padding: 10px 10px 10px 10px ;
			position: relative ;
		}

		li div {
			background-color: #FAFAFA ;
			bottom: 0px ;
			left: 0px ;
			padding: 10px 10px 10px 10px ;
			position: absolute ;
			right: 0px ;
			top: 0px ;
		}

	</style>
</head>
<body>

	<h1>
		Delegated Transclusion		
	</h1>

	<ul bn-list>

		<li 
			ng-repeat="friend in friends"
			ng-controller="FriendController">

			<a ng-click="showOverlay()">{{ friend.name }}</a>

			<div
				ng-show="isShowingOverlay"
				ng-click="hideOverlay()"
				bn-log="isShowingOverlay">

				Woot!

			</div>

		</li>

	</ul>

	


	<!-- Load jQuery and AngularJS from the CDN. -->
	<script
		type="text/javascript"
		src="//code.jquery.com/jquery-2.0.3.min.js">
	</script>
	<script
		type="text/javascript"
		src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js">
	</script>
	<script type="text/javascript">


		// Create an application module for our demo.
		var app = angular.module( "Demo", [] );


		// -------------------------------------------------- //
		// -------------------------------------------------- //


		// Define the root-level controller for the application.
		app.controller(
			"AppController",
			function( $scope ) {

				$scope.friends = [
					{
						id: 1,
						name: "Sarah"
					},
					{
						id: 2,
						name: "Joanna"
					},
					{
						id: 3,
						name: "Tricia"
					},
					{
						id: 4,
						name: "Kim"
					}
				];

			}
		);


		app.controller(
			"FriendController",
			function( $scope ) {

				$scope.isShowingOverlay = false;

				$scope.showOverlay = function() {

					$scope.isShowingOverlay = true;

				};

				$scope.hideOverlay = function() {

					$scope.isShowingOverlay = false;

				};

			}
		);


		app.directive(
			"bnList",
			function( $compile ) {

				function compile( tElement, tAttributes, tTransclude ) {

					var tOverlay = tElement.find( "li div" ).remove();
					var transcludeOverlay = $compile( tOverlay );

					function link( $scope, element, attributes ) {

						element.on(
							"mouseenter",
							"li",
							function( event ) {

								var item = $( this );
								var overlay = item.find( "div" );

								if ( overlay.length ) {

									return;

								}

								var localScope = item.scope();

								transcludeOverlay(
									localScope,
									function( overlayClone, $scope ) {

										item.append( overlayClone );

									}
								);

								localScope.$apply();

							}
						);

					}

					return( link );

				}

				return({
					compile: compile
				});

			}
		);

		app.directive(
			"bnLog",
			function() {

				function link( $scope, element, attributes ) {

					$scope.$watch(
						attributes.bnLog,
						function( value ) {

							console.log( value, $scope.$index );

						}
					);

				}

				return({
					link: link
				});

			}
		);


		// -------------------------------------------------- //
		// -------------------------------------------------- //


		

	</script>

</body>
</html>